name: Upload Release Notes

on:
  release:
    types: [published]

jobs:
  create-card:
    runs-on: ubuntu-latest
    steps:
    
    - name: Lint notes
      shell: bash
      run: echo "RELEASE_NOTES=$(${{ github.workspace }}/scripts/lint-changelog.sh '${{ github.event.release.body }}')" >> $GITHUB_ENV

    - name: Deploy Stage
      uses: fjogeleit/http-request-action@v1
      with:
        url: 'https://human-changelog-git-main-cold-briu.vercel.app/api/changelogs'
        method: 'POST'
        customHeaders: '{"Content-Type": "application/json"}'
        data: >-
            { 
              "name" : "${{ github.event.release.name }}", 
              "origin" : "${{ github.repository }}", 
              "version" : "${{ github.event.release.tag_name }}", 
              "changelog" : "${{ env.RELEASE_NOTES || 'MISSING_NOTES' }}"
            }
